apiVersion: kuttl.dev/v1beta1
kind: TestStep
commands:
- script: |
    if [ -z $CI ]; then
      label_value=$(oc get  subscriptions openshift-gitops-operator -n openshift-operators -o json | jq '.spec.config.env[]|select(.name=="DISABLE_DEFAULT_ARGOCD_CONSOLELINK").value')

      if ! [[ "${label_value}" == '"false"' ]]; then
        echo "DISABLE_DEFAULT_ARGOCD_CONSOLELINK set"
        exit 1
      else
        exit 0
      fi

    else
      label_value=$(oc get subscription gitops-operator-v1-8-0-sub -n openshift-operators -o json | jq '.spec.config.env[]|select(.name=="DISABLE_DEFAULT_ARGOCD_CONSOLELINK").value')
      
      if ! [[ "${label_value}" == '"false"' ]]; then
        echo "DISABLE_DEFAULT_ARGOCD_CONSOLELINK set"
        exit 1
      else
        exit 0
      fi
      
    fi
