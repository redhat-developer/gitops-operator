apiVersion: kuttl.dev/v1beta1
kind: TestStep
commands:
- script: |
    if [ -z $CI ]; then
      label_value=$(oc get  subscriptions openshift-gitops-operator -n openshift-operators -o json | jq '.spec.config.env[]|select(.name=="DISABLE_DEFAULT_ARGOCD_CONSOLELINK").value')
      
      if ! [[ "${label_value}" == '"true"' ]]; then
        echo "Label value: $label_value"
        echo "DISABLE_DEFAULT_ARGOCD_CONSOLELINK not set"
        exit 1
      else
        exit 0
      fi

    else
      label_value=$(oc get subscription gitops-operator-v0-0-3-sub -n openshift-operators -o json | jq '.spec.config.env[]|select(.name=="DISABLE_DEFAULT_ARGOCD_CONSOLELINK").value')
      
      if ! [[ "${label_value}" == '"true"' ]]; then
        echo "Label value: $label_value"
        echo "DISABLE_DEFAULT_ARGOCD_CONSOLELINK not set"
        exit 1
      else
        exit 0
      fi
      
    fi
